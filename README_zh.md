# OCR音频识别系统 Web版

这是一个基于Web的OCR音频识别系统，集成了文件上传、自动分类、语音识别和OCR处理功能。用户可以通过Web界面上传文件，录制音频指令，然后将文件内容和音频内容一起发送给OCR接口进行处理。

## 功能特点

### 1. 文件上传与自动分类
- 支持图片文件（jpg, jpeg, png, bmp, tiff）和PDF文件
- 自动将文件分为四大类：
  - **发票类**: 发票、税票、收据等财务文档
  - **合同类**: 合同、协议、结算书等法律文档  
  - **证书类**: 证书、资质、许可证等证明文档
  - **其他类**: 无法明确分类的其他文档

### 2. 实时语音识别
- 基于FunASR的Paraformer模型
- 实时音频采集和处理
- 支持中文语音识别
- 可视化显示识别结果

### 3. 综合OCR处理
- 将文件字节流和音频文字同时发送给OCR接口
- 支持自定义OCR API地址
- 实时显示处理结果

## 文件结构

```
├── web_launcher.py            # Web应用启动器
├── paraformer.py              # 语音识别模块
├── file_classifier.py         # 文件分类分析工具
├── config.json                # 系统配置文件
├── web/                       # Web应用目录
│   ├── app.py                 # Flask Web应用主程序
│   ├── audio_config.py        # 音频配置
│   ├── requirements.txt       # Web应用依赖包列表
│   ├── templates/             # HTML模板目录
│   │   └── index.html         # 主页模板
│   ├── static/                # 静态资源目录
│   │   ├── css/               # CSS样式文件
│   │   │   └── style.css      # 主样式表
│   │   └── js/                # JavaScript脚本
│   │       └── app.js         # 主脚本文件
│   └── uploads/               # Web应用文件上传目录
├── uploads/                   # 文件上传目录
├── README.md                  # 英文说明文档
└── README_zh.md               # 中文说明文档
```

## 安装与配置

### 1. 安装依赖

```bash
pip install -r web/requirements.txt
```

### 2. 配置语音识别模型

下载Paraformer模型并将其放置在指定位置：

```
E:\Huggingface\models\paraformer-zh-streaming
```

如果需要使用其他位置，请修改web/app.py文件中的模型路径。

### 3. 配置浏览器

确保您的浏览器允许访问麦克风，以进行实时语音识别。

## 使用方法

### 启动Web应用

```bash
python web_launcher.py
```

启动器会自动检查Python环境、依赖包和模型路径，提供完整的环境验证后启动web服务器。

### 命令行选项

```bash
python web_launcher.py [选项]
```

选项:
- `--debug`: 启用debug模式
- `--no-browser`: 不自动打开浏览器
- `--port PORT`: 指定服务器端口 (默认: 8080)

### 使用Web界面

1. **打开浏览器**: 访问 http://localhost:8080 (或您指定的端口)
2. **上传文件**: 点击"上传文件"按钮，选择要处理的文档
3. **录制音频**: 点击麦克风图标，说出对文档的处理要求
4. **发送处理**: 如有需要配置OCR API地址，点击"发送处理"
5. **查看结果**: 在结果区域查看OCR处理结果

## 注意事项

1. 确保系统已安装必要的依赖包
2. 确保Paraformer模型已正确下载并放置在指定位置
3. 确保OCR API接口可访问
4. 确保使用支持WebRTC的现代浏览器（Chrome、Firefox、Edge等）
5. 确保浏览器允许访问麦克风
6. 默认情况下，Web应用绑定到所有网络接口(0.0.0.0)，端口8080

## API接口格式

系统发送给OCR接口的数据格式：

```json
{
  "file": "文件字节流",
  "metadata": {
    "category": "文件分类（发票类/合同类/证书类/其他类）",
    "audio_text": "录制的音频转换的文字内容", 
    "file_info": {
      "name": "文件名",
      "size": "文件大小"
    }
  }
}
```

预期的API响应格式：
```json
{
  "status": "success",
  "processing_time": "处理时间",
  "result": "OCR识别结果"
}
```

## 文件分类规则

系统使用关键词匹配进行自动分类：

| 分类 | 关键词 | 说明 |
|------|--------|------|
| 发票类 | 发票、税票、收据、开票、税额、金额、购买方、销售方 | 财务相关文档 |
| 合同类 | 合同、协议、结算、审定书、建设、施工、甲方、乙方 | 法律文档 |
| 证书类 | 证书、资质、许可、认证、等保、测评、资格 | 证明文档 |
| 其他类 | - | 无法明确分类的文档 |

## 音频提示语示例

根据不同文件类型，建议使用以下音频指令：

- **发票类**: "请识别这张发票的关键信息，包括开票日期、金额、购买方和销售方信息"
- **合同类**: "请提取合同中的甲乙双方信息、合同金额和主要条款"  
- **证书类**: "请识别证书的类型、颁发机构、有效期和相关资质信息"
- **其他类**: "请识别文档中的所有重要文字内容和关键信息"

## 系统要求

- Python 3.7+
- Windows操作系统（已配置PowerShell）
- 音频输入设备（麦克风）
- 网络连接（用于访问OCR API）

## 故障排除

### 常见问题

1. **模型加载失败**
   - 检查模型路径是否正确
   - 确保已安装funasr包

2. **音频录制失败**
   - 检查麦克风是否正常工作
   - 确认pyaudio包已正确安装

3. **OCR接口调用失败**
   - 检查API地址是否正确
   - 确认网络连接正常
   - 检查API服务是否正在运行

### 调试方法

运行文件分类分析工具查看样例文件分析结果：
```bash
python file_classifier.py
```

运行增强测试工具验证接口功能：
```bash
python test_enhanced.py
```

## 开发说明

- `web_launcher.py`: Web应用启动器脚本
- `web/app.py`: Flask主应用程序，包含路由和Socket处理程序
- `paraformer.py`: 语音识别模块
- `file_classifier.py`: 文件分类分析工具
- `web/static/js/app.js`: 客户端JavaScript，用于音频录制和界面交互
- `web/templates/index.html`: 主Web界面模板

## 扩展功能

可以考虑添加的功能：

- 支持更多文件格式
- 增加更多文件分类
- 优化语音识别准确率
- 添加结果导出功能
- 支持批量文件处理
- 用户认证和历史记录保存
- 响应式设计以支持移动设备
