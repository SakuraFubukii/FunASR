# OCR音频识别系统

这是一个集成了文件上传、自动分类、语音识别和OCR处理的综合系统。用户可以上传文件，录制音频指令，然后将文件内容和音频内容一起发送给OCR接口进行处理。

## 功能特点

### 1. 文件上传与自动分类
- 支持图片文件（jpg, jpeg, png, bmp, tiff）和PDF文件
- 自动将文件分为四大类：
  - **发票类**: 发票、税票、收据等财务文档
  - **合同类**: 合同、协议、结算书等法律文档  
  - **证书类**: 证书、资质、许可证等证明文档
  - **其他类**: 无法明确分类的其他文档

### 2. 实时语音识别
- 基于FunASR的Paraformer模型
- 实时音频采集和处理
- 支持中文语音识别
- 可视化显示识别结果

### 3. 综合OCR处理
- 将文件字节流和音频文字同时发送给OCR接口
- 支持自定义OCR API地址
- 实时显示处理结果

## 文件结构

```
├── main.py                    # 主程序 - 桌面GUI界面
├── launcher.py                # 桌面应用启动器
├── web_launcher.py            # Web应用启动器（新增）
├── paraformer.py              # 原始语音识别模块
├── file_classifier.py         # 文件分类分析工具
├── config.json                # 系统配置文件
├── requirements.txt           # 依赖包列表
├── web/                       # Web应用目录（新增）
│   ├── app.py                 # Web应用主程序
│   ├── requirements.txt       # Web应用依赖包列表
│   ├── templates/             # HTML模板目录
│   │   └── index.html         # 主页模板
│   ├── static/                # 静态资源目录
│   │   ├── css/               # CSS样式文件
│   │   │   └── style.css      # 主样式表
│   │   └── js/                # JavaScript脚本
│   │       └── app.js         # 主脚本文件
│   └── uploads/               # 文件上传目录
├── README.md                  # 说明文档
└── README_zh.md               # 中文说明文档
```

## 安装与配置

### 1. 安装依赖

#### 桌面应用

```bash
pip install -r requirements.txt
```

#### Web应用

```bash
pip install -r web/requirements.txt
```

### 2. 下载并配置模型

下载Paraformer模型并将其放置在指定位置：

```
E:\Huggingface\models\paraformer-zh-streaming
```

如果需要使用其他位置，请修改配置文件中的路径。

## 使用方法

### 桌面应用版本

直接运行启动器：

```bash
python launcher.py
```

启动器会自动检查Python环境、依赖包和模型路径，提供完整的环境验证。

#### 使用说明

1. **选择文件**: 点击"选择文件"按钮，选择要处理的文档
2. **文件分类**: 系统会自动分类，也可以手动调整
3. **录制音频**: 点击"开始录音"，说出对文档的处理要求
4. **发送处理**: 配置OCR API地址，点击"发送OCR处理"
5. **查看结果**: 在结果区域查看OCR处理结果

### Web应用版本

运行Web版启动器：

```bash
python web_launcher.py
```

启动后，通过浏览器访问：`http://localhost:5000`

#### 使用说明

1. **选择文件**: 点击"选择文件"按钮，选择要处理的图片或PDF文件
2. **确认分类**: 系统会自动根据文件名推测分类，你也可以手动选择分类
3. **录制音频**: 点击"开始录音"按钮（需要允许浏览器使用麦克风），说出与文件相关的指令或描述，完成后点击"停止录音"
4. **发送处理**: 点击"发送OCR处理"按钮，将文件和音频文字发送给OCR接口
5. **查看结果**: 在结果区域查看OCR处理结果

### 命令行测试
```bash
# 基本测试
python test_enhanced.py

# 文件分类分析
python file_classifier.py

# 原始语音识别测试
python paraformer.py
```

## 注意事项

1. 确保系统已安装必要的依赖包
2. 确保Paraformer模型已正确下载并放置在指定位置
3. 确保OCR API接口可访问
4. Web应用版本需要支持WebRTC的现代浏览器（Chrome、Firefox、Edge等）
5. 对于Web应用版本，确保浏览器允许访问麦克风
6. 默认情况下，Web应用绑定到所有网络接口(0.0.0.0)，端口5000，如需修改，请编辑`web_launcher.py`文件

## API接口格式

系统发送给OCR接口的数据格式：

```json
{
  "file": "文件字节流",
  "metadata": {
    "category": "文件分类（发票类/合同类/证书类/其他类）",
    "audio_text": "录制的音频转换的文字内容", 
    "file_info": {
      "name": "文件名",
      "size": "文件大小"
    }
  }
}
```

预期的API响应格式：
```json
{
  "status": "success",
  "processing_time": "处理时间",
  "result": "OCR识别结果"
}
```

## 文件分类规则

系统使用关键词匹配进行自动分类：

| 分类 | 关键词 | 说明 |
|------|--------|------|
| 发票类 | 发票、税票、收据、开票、税额、金额、购买方、销售方 | 财务相关文档 |
| 合同类 | 合同、协议、结算、审定书、建设、施工、甲方、乙方 | 法律文档 |
| 证书类 | 证书、资质、许可、认证、等保、测评、资格 | 证明文档 |
| 其他类 | - | 无法明确分类的文档 |

## 音频提示语示例

根据不同文件类型，建议使用以下音频指令：

- **发票类**: "请识别这张发票的关键信息，包括开票日期、金额、购买方和销售方信息"
- **合同类**: "请提取合同中的甲乙双方信息、合同金额和主要条款"  
- **证书类**: "请识别证书的类型、颁发机构、有效期和相关资质信息"
- **其他类**: "请识别文档中的所有重要文字内容和关键信息"

## 系统要求

- Python 3.7+
- Windows操作系统（已配置PowerShell）
- 音频输入设备（麦克风）
- 网络连接（用于访问OCR API）

## 故障排除

### 常见问题

1. **模型加载失败**
   - 检查模型路径是否正确
   - 确保已安装funasr包

2. **音频录制失败**
   - 检查麦克风是否正常工作
   - 确认pyaudio包已正确安装

3. **OCR接口调用失败**
   - 检查API地址是否正确
   - 确认网络连接正常
   - 检查API服务是否正在运行

### 调试方法

运行文件分类分析工具查看样例文件分析结果：
```bash
python file_classifier.py
```

运行增强测试工具验证接口功能：
```bash
python test_enhanced.py
```

## 开发说明

- `main.py`: 主程序，包含完整的GUI界面和功能逻辑
- `paraformer.py`: 原始的命令行语音识别程序
- `file_classifier.py`: 文件分类分析工具，用于分析样例文件
- `test_enhanced.py`: 增强的测试程序，展示完整的API调用流程

## 扩展功能

可以考虑添加的功能：
- 支持更多文件格式
- 增加更多文件分类
- 优化语音识别准确率
- 添加结果导出功能
- 支持批量文件处理
